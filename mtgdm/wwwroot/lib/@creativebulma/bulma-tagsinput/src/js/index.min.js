/**
 * Minified by jsDelivr using Terser v5.3.0.
 * Original file: /npm/@creativebulma/bulma-tagsinput@1.0.3/src/js/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Component from"./utils/component";import{cloneAttributes}from"./utils/dom";import{isString,BooleanParse,isObject,isPromise,isFunction}from"./utils/type";import defaultOptions from"./defaultOptions";import tagTemplate from"./templates/tag";import containerTemplate from"./templates/wrapper";import dropdownItemTemplate from"./templates/dropdown-item";export default class BulmaTagsInput extends Component{constructor(t,e={}){super(t,e,defaultOptions),this.options.allowDuplicates=BooleanParse(this.options.allowDuplicates),this.options.caseSensitive=BooleanParse(this.options.caseSensitive),this.options.clearSelectionOnTyping=BooleanParse(this.options.clearSelectionOnTyping),this.options.closeDropdownOnItemSelect=BooleanParse(this.options.closeDropdownOnItemSelect),this.options.freeInput=BooleanParse(this.options.freeInput),this.options.highlightDuplicate=BooleanParse(this.options.highlightDuplicate),this.options.highlightMatchesString=BooleanParse(this.options.highlightMatchesString),this.options.removable=BooleanParse(this.options.removable),this.options.searchOn=this.options.searchOn.toLowerCase(),this.options.selectable=BooleanParse(this.options.selectable),this.options.trim=BooleanParse(this.options.trim),this._onDocumentClick=this._onDocumentClick.bind(this),this._onInputChange=this._onInputChange.bind(this),this._onInputClick=this._onInputClick.bind(this),this._onInputFocusOut=this._onInputFocusOut.bind(this),this._onInputFocusIn=this._onInputFocusIn.bind(this),this._onInputKeyDown=this._onInputKeyDown.bind(this),this._onInputKeyPress=this._onInputKeyPress.bind(this),this._onOriginalInputChange=this._onOriginalInputChange.bind(this),this._onTagDeleteClick=this._onTagDeleteClick.bind(this),this._onTagClick=this._onTagClick.bind(this),this._onDropdownItemClick=this._onDropdownItemClick.bind(this),this.items=[],this._selected=-1,this._init()}static attach(t='input[data-type="tags"], input[type="tags"], select[data-type="tags"], select[type="tags"]',e={},i=null){return super.attach(t,e,i)}_init(){this._isSelect="SELECT"===this.element.tagName,this._isMultiple=this._isSelect&&this.element.hasAttribute("multiple"),this._objectItems=void 0!==this.options.itemValue||this._isSelect,this.options.itemValue=this.options.itemValue?this.options.itemValue:this._isSelect?"value":void 0,this.options.itemText=this.options.itemText?this.options.itemText:this._isSelect?"text":void 0,void 0===this.options.itemText&&(this.options.itemText=this.options.itemValue),this.options.freeInput=!this._objectItems&&this.options.freeInput,this.source=null,void 0!==this.options.source&&(["value","text"].includes(this.options.searchOn)||(this.options.searchOn=defaultOptions.searchOn),isPromise(this.options.source)?this.source=this.options.source:isFunction(this.options.source)?this.source=t=>Promise.resolve(this.options.source(t)):Array.isArray(this.options.source)&&(this.source=t=>Promise.resolve(this.options.source.filter(e=>{const i=this._objectItems?e[this.options.itemValue]:e;return this.options.caseSensitive?i.includes(t):i.toLowerCase().includes(t.toLowerCase())})))),this._manualInputAllowed=!this._isSelect&&this.options.freeInput,this._filterInputAllowed=this._isSelect||this.source,this._build()}_build(){const t=document.createRange().createContextualFragment(containerTemplate({emptyTitle:void 0!==this.options.noResultsLabel?this.options.noResultsLabel:"No results found",placeholder:this.element.placeholder?this.element.placeholder:this.options.placeholder,uuid:this.id}));this.container=t.firstElementChild,this.input=this.container.querySelector("input"),this.dropdown=this.container.querySelector(`#${this.id}-list .dropdown-content`),this.dropdownEmptyOption=this.dropdown.querySelector(".empty-title"),cloneAttributes(this.input,this.element,"data-type multiple name type value"),this.element.disabled&&(this.container.setAttribute("disabled","disabled"),this.options.removable=!1,this.options.selectable=!1),(this.input.getAttribute("disabled")||this.input.classList.contains("is-disabled"))&&this.container.setAttribute("disabled","disabled"),this._manualInputAllowed||this.container.classList.add(this._filterInputAllowed?"is-filter":"no-input"),this._isSelect||void 0!==this.options.source||(this.dropdown.remove(),this.dropdown=null,this.input.setAttribute("list",null)),this._isSelect?Array.from(this.element.options).forEach(t=>{t.selected&&this.add(t.value?t:{value:t.text,text:t.text},!0),this._createDropdownItem(t)}):this.element.value.length&&this.add(this._objectItems?JSON.parse(this.element.value):this.element.value,!0),this._bindEvents(),this.element.parentNode.insertBefore(this.container,this.element),this.element.style.display="none"}_bindEvents(){document.addEventListener("click",this._onDocumentClick),this.element.addEventListener("change",this._onOriginalInputChange),this.input.addEventListener("input",this._onInputChange),this.input.addEventListener("click",this._onInputClick),this.input.addEventListener("keydown",this._onInputKeyDown),this.input.addEventListener("keypress",this._onInputKeyPress),this.input.addEventListener("focusout",this._onInputFocusOut),this.input.addEventListener("focusin",this._onInputFocusIn)}_caretAtStart(){try{return 0===this.input.selectionStart&&0===this.input.selectionEnd}catch(t){return""===this.input.value}}_checkLength(t){const e=this._objectItems?t[this.options.itemValue]:t;return!isString(e)||e.length>=this.options.minChars&&(void 0===this.options.maxChars||e.length<=this.options.maxChars)}_closeDropdown(){this.dropdown&&(this.emit("before.dropdown.close",this),this.container.classList.remove("is-active"),this.emit("after.dropdown.close",this))}_createDropdownItem(t){if(this.dropdown){const e=document.createRange().createContextualFragment(dropdownItemTemplate({text:t.text,value:t.value})).firstElementChild;e.dataset.value=t.value,e.dataset.text=t.text,e.addEventListener("click",this._onDropdownItemClick),this.dropdown.append(e)}}_createTag(t){const e=document.createRange().createContextualFragment(tagTemplate({removable:this.options.removable,style:this.options.tagClass,text:t.text,value:t.value})).firstElementChild;if(e.addEventListener("click",this._onTagClick),this.options.removable){const t=e.querySelector(".delete");t&&t.addEventListener("click",this._onTagDeleteClick)}this.container.insertBefore(e,this.input)}_emptyDropdown(){this.dropdown&&Array.from(this.dropdown.children).filter(t=>!t.classList.contains("empty-title")).forEach(t=>{t.remove()})}_highlightMatchesInString(t,e){const i=new RegExp("("+e+")(?![^<]*>|[^<>]*</)","i");if(!t.match(i))return t;const s=t.match(i).index,o=s+t.match(i)[0].toString().length,n=t.substring(s,o);return t=t.replace(i,`<mark class="is-highlighted">${n}</mark>`)}_openDropdown(){this.dropdown&&this.container.classList.add("is-active")}_propagateChange(){this._isSelect?(Array.from(this.element.options).forEach(t=>{t.setAttribute("selected",void 0),t.selected=!1,void 0!==t.dataset.source&&t.remove()}),this.items.forEach(t=>{this._updateSelectOptions({value:this._objectItems?t[this.options.itemValue]:t,text:this._objectItems?t[this.options.itemText]:t})})):this.element.value=this.value;const t=new CustomEvent("change",{detail:this.constructor.name});this.element.dispatchEvent(t)}_trim(t){return this.options.trim&&(this._objectItems?(isString(t[this.options.itemValue])&&(t[this.options.itemValue]=t[this.options.itemValue].trim()),isString(t[this.options.itemText])&&(t[this.options.itemText]=t[this.options.itemText].trim())):t=t.trim()),t}_filterDropdownItems(t=null){if(this.dropdown&&this.emit("before.dropdown.filter",this)){Array.from(this.dropdown.children).filter(t=>!t.classList.contains("empty-title")).forEach(e=>{const i=e.dataset[this.options.searchOn];if(this.options.highlightMatchesString&&(e.textContent=e.textContent.replace(/<\/?(mark\s?(class="is\-highlighted")?)?>]*>?/gm,"")),t&&t.length?(this.options.caseSensitive?e.style.display=i.includes(t)?"block":"none":e.style.display=i.toLowerCase().includes(t.toLowerCase())?"block":"none",this.options.highlightMatchesString&&(e.innerHTML=this._highlightMatchesInString(e.innerHTML,t))):e.style.display="block",!this.options.allowDuplicates||this._isSelect&&!this._isMultiple){const t="value"===this.options.searchOn?this.hasValue(i):this.hasText(i);e.style.display=t?"none":e.style.display}});const e=Array.from(this.dropdown.children).filter(t=>!t.classList.contains("empty-title")).some(t=>"none"!==t.style.display);return this.dropdownEmptyOption.style.display=e?"none":"block",this.emit("after.dropdown.filter",this),e}return!0}_updateSelectOptions(t){if(this._isSelect){let e=this.element.querySelector(`option[value="${encodeURIComponent(t.value)}"]`)||this.element.querySelector(`option[value="${t.value}"]`);if(!e){e=document.createRange().createContextualFragment(`<option value="${t.value}" data-source="${this.id}" selected>${t.text}</option>`).firstElementChild,this.element.add(e)}e.setAttribute("selected","selected"),e.selected=!0}}add(t,e=!1){if(void 0!==this.options.maxTags&&this.items.length>=this.options.maxTags)return this;if(t=Array.isArray(t)?t:isObject(t)?[t]:t.split(this.options.delimiter),!this._objectItems&&t.filter(t=>isString(t)).length!==t.length)throw"Item must be a string or an array of strings";if(this._objectItems&&t.filter(t=>isObject(t)).length!==t.length)throw"Item must be an object or an array of objects";return t.forEach(t=>{if(t=this._trim(t),this._checkLength(t)&&(this._isSelect&&!this._isMultiple&&this.items.length>0&&(this.removeAtIndex(0),this.element.remove(this.element.selectedIndex)),t=this.emit("before.add",t)))if(this.options.allowDuplicates||!this.has(t)){const i={value:this._objectItems?t[this.options.itemValue]:t,text:this._objectItems?t[this.options.itemText]:t},s=this._createTag(i);this.items.push(t),e||(this._propagateChange(),this.emit("after.add",{item:t,tag:s}))}else{if(this.options.highlightDuplicate){const e=Array.from(this.container.children).filter(t=>t.classList.contains("tag"))[this.indexOf(t)];e&&(e.classList.add("is-duplicate"),setTimeout(()=>{e.classList.remove("is-duplicate")},1250))}this.emit("item.duplicate",t)}}),this}clearSelection(){if(this._selected>=0){const t=this.items[this._selected],e=Array.from(this.container.children).filter(t=>t.classList.contains("tag"))[this._selected];this.emit("before.unselect",{item:t,tag:e})&&(e&&e.classList.remove("is-selected"),this._selected=-1,this.emit("after.unselect",{item:t,tag:e}))}return this}flush(){return this.removeAll()}focus(){return this.container.classList.add("is-focused"),this.input.focus(),this}has(t){return t=this._trim(t),this._objectItems?this.items.some(e=>this.options.caseSensitive||!isString(e[this.options.itemValue])?e[this.options.itemValue]===t[this.options.itemValue]:e[this.options.itemValue].toLowerCase()===t[this.options.itemValue].toLowerCase()):this.hasValue(t)}hasText(t){return this.options.trim&&(t=t.trim()),this.items.some(e=>{const i=this._objectItems?e[this.options.itemText]:e;return this.options.caseSensitive?i===t:i.toLowerCase()===t.toLowerCase()})}hasValue(t){return this.options.trim&&(t=t.trim()),this.items.some(e=>{const i=this._objectItems?e[this.options.itemValue]:e;return this.options.caseSensitive?i===t:i.toLowerCase()===t.toLowerCase()})}indexOf(t){if(t=this._trim(t),this._objectItems){if(!isObject(t))throw"Item must be an object";return this.items.map((function(t){return t.value})).indexOf(t.value)}return this.items.indexOf(t)}input(){return this.input}items(){return this.items}remove(t){if(this.options.removable){if(t=Array.isArray(t)?t:isObject(t)?[t]:t.split(this.options.delimiter),!this._objectItems&&t.filter(t=>isString(t)).length!==t.length)throw"Item must be a string or an array of strings";if(this._objectItems&&t.filter(t=>isObject(t)).length!==t.length)throw"Item must be an object or an array of objects";t.forEach(t=>{let e=this.indexOf(t);for(;e>=0;)this.removeAtIndex(e),e=this.indexOf(t)})}return this}removeAll(){return this.options.removable&&this.emit("before.flush",this.items)&&(this.clearSelection(),Array.from(this.container.children).filter(t=>t.classList.contains("tag")).forEach(t=>t.remove()),this.items=[],this._filterDropdownItems(),this._propagateChange(),this.emit("after.flush",this.items)),this}removeAtIndex(t,e=!0){if(this.options.removable&&!isNaN(t)&&t>=0&&t<this.items.length){const i=Array.from(this.container.children).filter(t=>t.classList.contains("tag"))[t],s=this.items[t];this.emit("before.remove",s)&&(e&&this.clearSelection(),i&&i.remove(),this._isSelect&&(this.element.options[t].selected=!1),this._selected==t?this._selected=-1:this._selected>=0&&(this._selected-=1),this.items.splice(t,1),this._filterDropdownItems(),this._propagateChange(),this.emit("after.remove",s))}return this}select(t){if(this.options.selectable){if(t=Array.isArray(t)?t:isObject(t)?[t]:t.split(this.options.delimiter),!this._objectItems&&t.filter(t=>isString(t)).length!==t.length)throw"Item must be a string or an array of strings";if(this._objectItems&&t.filter(t=>isObject(t)).length!==t.length)throw"Item must be an object or an array of objects";t.forEach(t=>{this.selectAtIndex(this.indexOf(t))})}return this}selectAtIndex(t){if(this.options.selectable&&(this.clearSelection(),!isNaN(t)&&t>=0&&t<this.items.length)){const e=Array.from(this.container.children).filter(t=>t.classList.contains("tag"))[t],i=this.items[t];this.emit("before.select",{item:i,tag:e})&&(e&&e.classList.add("is-selected"),this._selected=t,this.emit("after.select",{item:i,tag:e}))}return this}get selected(){return this._selected>=0?this.items[this._selected]:null}get selectedIndex(){return this._selected}get value(){return this._isSelect?Array.from(this.element.options).filter(t=>t.selected).map(t=>t.value):this._objectItems?this.items.map(t=>t.value).join(this.options.delimiter):this.items.join(this.options.delimiter)}set value(t){this.removeAll(),this.add(t)}_onDocumentClick(t){if(this.dropdown){if(this.container.contains(t.target))return;if(t.target.dataset.tag&&"delete"===t.target.dataset.tag)return;this._closeDropdown()}}_onDropdownItemClick(t){if(t.preventDefault(),this.dropdown){if(this._objectItems){let e={};e[this.options.itemText]=t.currentTarget.dataset.text,e[this.options.itemValue]=t.currentTarget.dataset.value,this.add(e)}else this.add(t.currentTarget.dataset.value);this._filterDropdownItems(),this.input.value="",this.input.focus(),this.options.closeDropdownOnItemSelect&&this._closeDropdown()}}_onInputChange(t){this._filterDropdownItems(this.input.value)}_onInputClick(t){t.preventDefault(),(!this.source||this.input.value.length>=this.options.searchMinChars)&&(this._openDropdown(),this._filterDropdownItems())}_onInputFocusIn(t){if(t.preventDefault(),null!==this.container.getAttribute("disabled")||this.container.classList.contains("is-disabled"))return this.input.blur(),!1;this.container.classList.add("is-focused")}_onInputFocusOut(t){t.preventDefault(),this.container.classList.remove("is-focused")}_onInputKeyDown(t){switch(t.charCode||t.keyCode||t.which){case 8:if(this.options.removable&&this._caretAtStart()&&this._selected>=0){const t=this._selected;t>=0&&this.selectAtIndex(t+1<this.items.length?t+1:t-1),this.removeAtIndex(t,!1)}this.source&&this.input.value.length<this.options.searchMinChars&&this._closeDropdown();break;case 27:this._selected>=0&&this.clearSelection(),this._closeDropdown();break;case 46:if(this.options.removable&&this._caretAtStart()&&this._selected>=0){const t=this._selected;t>=0&&this.selectAtIndex(t+1<this.items.length?t+1:t-1),this.removeAtIndex(t,!1)}this.source&&this.input.value.length<this.options.searchMinChars&&this._closeDropdown();break;case 37:this.input.value.length||(this._selected<0?this.selectAtIndex(this.items.length-1):this.selectAtIndex(this._selected-1>=0?this._selected-1:this.items.length-1));break;case 39:this.input.value.length||(this._selected<0?this.selectAtIndex(0):this.selectAtIndex(this._selected+1>=this.items.length?0:this._selected+1));break;default:this.options.clearSelectionOnTyping&&this.clearSelection()}}_onInputKeyPress(t){const e=t.charCode||t.keyCode||t.which;let i=this._trim(this.input.value)+String.fromCharCode(e);if(!this._manualInputAllowed&&!this._filterInputAllowed)return t.preventDefault(),!1;if(!i.length&&13!==e)return!1;if(this._filterInputAllowed&&this._filterDropdownItems(i),this._filterInputAllowed&&this.source&&i.length>=this.options.searchMinChars&&13!==e&&(this._openDropdown(),this.dropdown.classList.add("is-loading"),this._emptyDropdown(),this.source(i).then(t=>{(t=this.emit("on.results.received",t)).length&&t.forEach(t=>{let e={value:null,text:null};isObject(t)?(e.value=t[this.options.itemValue],e.text=t[this.options.itemText]):(e.value=t,e.text=t),this._createDropdownItem(e)}),this._filterDropdownItems(i),this.dropdown.classList.remove("is-loading")}).catch(t=>{console.log(t)})),this._manualInputAllowed&&(i.includes(this.options.delimiter)||13==e)){t.preventDefault();return i.split(this.options.delimiter).forEach(t=>{""!=(t=t.replace(this.options.delimiter,""))&&this.add(t)}),i="",this.input.value="",this._closeDropdown(),!1}}_onOriginalInputChange(t){(!t.detail||isString(t.detail)&&t.detail!==this.constructor.name)&&(this.value=t.currentTarget.value)}_onTagClick(t){if(t.preventDefault(),t.currentTarget.classList.contains("delete"))return!1;if(null!==this.container.getAttribute("disabled")||this.container.classList.contains("is-disabled"))return!1;if(this.input.focus(),this.options.selectable){const e=t.currentTarget.closest(".tag");if(e){const t=Array.from(this.container.children).indexOf(e);t===this._selected?this.clearSelection():this.selectAtIndex(t)}}}_onTagDeleteClick(t){if(t.preventDefault(),null!==this.container.getAttribute("disabled")||this.container.classList.contains("is-disabled"))return!1;const e=t.currentTarget.closest(".tag");e&&this.removeAtIndex(Array.from(this.container.children).indexOf(e))}}
//# sourceMappingURL=/sm/bec3cc08a9f5c00bce870b847fd858bc73125e056e34bf3f8483c55730a7f587.map